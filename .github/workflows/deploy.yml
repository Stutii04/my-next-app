- name: Authenticate to Portainer
  run: |
    set -e
    RESPONSE=$(curl -s -w "\n%{http_code}" -X POST "$PORTAINER_URL/api/auth" \
      -H "Content-Type: application/json" \
      -d "{\"username\":\"$admin\",\"password\":\"$Yd5CwgeBSaCXSbB\"}")

    BODY=$(echo "$RESPONSE" | head -n1)
    STATUS=$(echo "$RESPONSE" | tail -n1)

    echo "Status: $STATUS"
    echo "Body: $BODY"

    if [ "$STATUS" -ne 200 ]; then
      echo "❌ Authentication failed"
      exit 1
    fi

    JWT=$(echo "$BODY" | jq -r '.jwt')
    echo "✅ Authentication successful, JWT acquired"
